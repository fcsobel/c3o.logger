"use strict";var Elmah={};Elmah.Net={};Elmah.Net.Models={};Elmah.Net.Models.SiteError=function(n,t,i,r,u){var e=this,f;r||(r="");!i&&n&&(i=n.message);!i&&n&&n.data&&(i=n.data.message);i||(i="");u||(u="error");this.error=n;this.cause=t;this.message=i;this.hide=!1;this.key=r;this.type=u;this.isParent=!0;f=n.siteError;this.children=[];f!=null&&(f.isParent=!1,this.child=f,this.children.push(f),this.index=f.index);n.siteError=this};Elmah.Net.Models.LogItem=function(n,t){var r=this,u,i,f;_.extend(this,n);this.visible=!1;this.messages=this.messages||[];this.counts=[];t&&(u=_.filter(t,{id:this.id}),i={},_.forEach(u,function(n){var t={x:moment(new Date(n.name)),y:n.count},u,f,e;i.x||(u={x:moment(t.x).subtract(1,"days"),y:0},r.counts.push(u));i.x&&(t.x.diff(i.x,"days")>1&&(f={x:moment(i.x).add(1,"days"),y:0},r.counts.push(f)),t.x.diff(i.x,"days")>2&&(e={x:moment(t.x).subtract(1,"d"),y:0},r.counts.push(e)));r.counts.push(t);i=t}),r.counts.length>0&&i.x&&(f={x:moment(i.x).add(1,"days"),y:0},r.counts.push(f)))};Elmah.Net.Models.LogItem.prototype={get Visible(){return this.visible||this.selected||this.messages&&this.messages.length>0}};Elmah.Net.Models.LogMessage=function(n,t){var i=this;_.extend(this,n);this.log=this.CheckItem(this.logId,t.logs,this.log);this.application=this.CheckItem(this.applicationId,t.applications,this.application);this.user=this.CheckItem(this.userId,t.users,this.user);this.messageType=this.CheckItem(this.messageTypeId,t.types,this.messageType);this.source=this.CheckItem(this.sourceId,t.sources,this.source);this.severityObj=_.find(t.severities,{name:this.severity});this.log&&this.CheckMessage(this.log);this.application&&this.CheckMessage(this.application);this.user&&this.CheckMessage(this.user);this.messageType&&this.CheckMessage(this.messageType);this.source&&this.CheckMessage(this.source);this.severityObj&&this.CheckMessage(this.severityObj)};Elmah.Net.Models.LogMessage.prototype={CheckItem:function(n,t,i){var r=_.find(t,{id:n});return!r&&i&&(r=i,t.push(r)),r},CheckMessage:function(n){if(n){n.messages=n.messages||[];var t=_.findIndex(n.messages,_.pick(this,"id"));t!==-1?n.messages.splice(t,1,this):n.messages.push(this)}}};Elmah.Net.Models.LogQuery=function(n){var t=this;_.extend(this,n);n.start&&n.end&&(n.startMoment=moment(n.start),n.endMoment=moment(n.end))};Elmah.Net.Models.LogSearchResponse=function(n){var t=this;_.extend(this,n);n.logs=n.logs||[];n.applications=n.applications||[];n.users=n.users||[];n.types=n.types||[];n.sources=n.sources||[];this.messages=$.map(n.messages,function(t){return new Elmah.Net.Models.LogMessage(t,n)});this.logs=$.map(n.logs,function(n){return new Elmah.Net.Models.LogItem(n)});this.applications=$.map(n.applications,function(n){return new Elmah.Net.Models.LogItem(n)});this.severities=$.map(n.severities,function(n){return new Elmah.Net.Models.LogItem(n)});this.types=$.map(n.types,function(t){return new Elmah.Net.Models.LogItem(t,n.typeCount2)});this.sources=$.map(n.sources,function(n){return new Elmah.Net.Models.LogItem(n)});this.users=$.map(n.users,function(n){return new Elmah.Net.Models.LogItem(n)});this.query=new Elmah.Net.Models.LogQuery(n.query);this.message=n.messages[0]};Elmah.Net.Models.Site=function(n){var t=this;_.extend(this,n)};Elmah.Net.Models.Site.prototype={},function(){angular.module("elmah.net.core",[])}(),function(){angular.module("elmah.net.core").factory("RecursionHelper",["$compile",function(n){return{compile:function(t,i){angular.isFunction(i)&&(i={post:i});var u=t.contents().remove(),r;return{pre:i&&i.pre?i.pre:null,post:function(t,f){r||(r=n(u));r(t,function(n){f.append(n)});i&&i.post&&i.post.apply(null,arguments)}}}}}])}(),function(){angular.module("elmah.net.core").directive("elmahNetErrorModel",function(){return{restrict:"AE",scope:{elmahNetErrorModel:"="},controller:function(n,t){n.elmahNetErrorModel||(n.elmahNetErrorModel=t.model.errors)}}})}(),function(){angular.module("elmah.net.core").directive("elmahNetErrorItem",function(){return{restrict:"AE",scope:{error:"=elmahNetErrorItem"},templateUrl:"/app/core/directives/ErrorItem.html",controller:function(){}}})}(),function(){angular.module("elmah.net.core").directive("elmahNetErrorList",function(){return{restrict:"AE",templateUrl:"/app/core/directives/ErrorList.html",controller:function(n,t){n.errors=t.list()}}})}(),function(){angular.module("elmah.net.core").directive("elmahNetErrorTreeItem",function(n){return{restrict:"AE",scope:{error:"=elmahNetErrorTreeItem"},templateUrl:"/app/core/directives/ErrorTreeItem.html",controller:function(){},compile:function(t){return n.compile(t)}}})}(),function(){angular.module("elmah.net.core").factory("ErrorService",[function(){var n={errors:[]};return{get model(){return n},list:function(){return n.errors},hide:function(){_.each(n.errors,function(n){n.hide=!0})},add:function(t,i,r,u,f){var e=new Elmah.Net.Models.SiteError(t,i,r,u,f);e.index>0?n.errors[e.index-1]=e:e.index=n.errors.push(e)}}}])}(),function(){angular.module("elmah.net.core").factory("SiteApi",["$http","$q","ErrorService",function(n,t,i){var r="/api.site/sites/";return{check:function(){return n.get(r).then(function(n){return n.data}).catch(function(n){return i.add(n,r,null,"SiteApi.search"),t.reject(n)})},create:function(u){var f={name:u};return n.post(r,f).then(function(n){return n.data}).catch(function(n){return i.add(n,r,f,"SiteApi.create"),t.reject(n)})},"delete":function(){return n.delete(r).then(function(n){return n.data}).catch(function(n){return i.add(n,r,name,"SiteApi.deleteByName"),t.reject(n)})}}}])}(),function(){angular.module("elmah.net.core").factory("SiteService",["$q","SiteApi","ErrorService",function(n,t,i){var r={model:{}},u=function(){return t.check().then(function(n){return n!=null&&(r.model=new Elmah.Net.Models.Site(n)),r}).catch(function(t){return i.add(t,null,null,"SiteService.check"),n.reject(t)})},f=function(){return t.create().then(function(n){return n!=null&&(r.model=new Elmah.Net.Models.Site(n)),r}).catch(function(t){return i.add(t,null,null,"SiteService.check"),n.reject(t)})};return{context:function(){return r},check:u,create:f}}])}(),function(){angular.module("elmah.net.logger",["ngSanitize","ngCookies","ngRoute","ngAnimate","angularSpinner","elmah.net.core","chart.js"]).config(["ChartJsProvider",function(n){n.setOptions({colors:["#803690","#00ADF9","#DCDCDC","#46BFBD","#FDB45C","#949FB1","#4D5360"],responsive:!0,fullWidth:!0,maintainAspectRatio:!1,title:{display:!1},legend:{display:!1}});n.setOptions("line",{showLines:!0,showLabels:!1,legend:{display:!1}})}])}(),function(){angular.module("elmah.net.logger").factory("LoggerApi",["$http","$q","ErrorService",function(n,t,i){var r="/api.logger";return{init:function(){return n.get(r+"/messages/init/").then(function(n){return n.data}).catch(function(n){return i.add(n,r+"/messages/init",data,"LoggerApi.init"),t.reject(n)})},searchAndUpdate:function(u,f,e,o,s,h,c,l,a,v,y,p,w){f.query={search:w,limit:e,span:o,logs:s,applications:h,severities:c,types:l,sources:a,users:v,start:y,end:p};return n.post(r+"/messages/search/"+encodeURIComponent(u),f).then(function(n){return n.data}).catch(function(n){return i.add(n,r+"/messages/search/"+u,f,"LoggerApi.searchAndUpdate"),t.reject(n)})},find:function(u){return n.get(r+"/messages/search/"+encodeURIComponent(u)).then(function(n){return n.data}).catch(function(n){return i.add(n,r+"/messages/search/"+u,u,"LoggerApi.searchByName"),t.reject(n)})},deleteByName:function(u){return n.delete(r+"/messages/search/"+encodeURIComponent(u)).then(function(n){return n.data}).catch(function(n){return i.add(n,r+"/messages/search/"+u,data,"LoggerApi.deleteByName"),t.reject(n)})},search:function(u,f,e,o,s,h,c,l,a,v,y){var p={params:{search:y,limit:u,span:f,logs:e,applications:o,severities:s,types:h,sources:c,users:l,start:a,end:v}};return n.get(r+"/messages/search",p).then(function(n){return n.data}).catch(function(n){return i.add(n,r+"/messages/search",p,"LoggerApi.search"),t.reject(n)})},detail:function(u){return n.get(r+"/messages/"+u).then(function(n){return n.data}).catch(function(n){return i.add(n,r+"/messages/"+u,null,"LoggerApi.detail"),t.reject(n)})},deleteMessage:function(u){return n.delete(r+"/messages/"+u).then(function(n){return n.data}).catch(function(n){return i.add(n,r+"/messages/"+u,null,"LoggerApi.deleteMessage"),t.reject(n)})}}}])}(),function(){angular.module("elmah.net.logger").factory("LogService",["$q","LoggerApi","ErrorService",function(n,t,i){var r={model:{messages:[]}},u=function(n){var t,i,u,f,e,o;return n.deleted?!1:(t=_.filter(r.model.logs,{selected:!0}),t=_.map(t,"id"),i=_.filter(r.model.applications,{selected:!0}),i=_.map(i,"id"),u=_.filter(r.model.types,{selected:!0}),u=_.map(u,"id"),f=_.filter(r.model.sources,{selected:!0}),f=_.map(f,"id"),e=_.filter(r.model.users,{selected:!0}),e=_.map(e,"id"),o=_.filter(r.model.severities,{selected:!0}),o=_.map(o,"name"),(u.length<=0||_.includes(u,n.messageTypeId))&&(f.length<=0||_.includes(f,n.sourceId))&&(i.length<=0||_.includes(i,n.applicationId))&&(t.length<=0||_.includes(t,n.logId))&&(o.length<=0||_.includes(o,n.severity))&&(e.length<=0||_.includes(e,n.userId)))},f=function(){return t.init().then(function(n){return r.model=new Elmah.Net.Models.LogSearchResponse(n),r}).catch(function(t){return i.add(t,null,null,"logService.search"),n.reject(t)})},e=function(u,f,e,o,s,h,c,l,a,v,y,p,w){return t.searchAndUpdate(u,f,e,o,s,h,c,l,a,v,y,p,w).then(function(n){return r.model=new Elmah.Net.Models.LogSearchResponse(n),r}).catch(function(t){return i.add(t,null,null,"logService.searchAndUpdate"),n.reject(t)})},o=function(u){return t.deleteByName(u).then(function(n){return r.model=new Elmah.Net.Models.LogSearchResponse(n),r}).catch(function(t){return i.add(t,null,null,"logService.search"),n.reject(t)})},s=function(u){return t.find(u).then(function(n){return r.model=new Elmah.Net.Models.LogSearchResponse(n),r}).catch(function(t){return i.add(t,null,null,"logService.search"),n.reject(t)})},h=function(u,f,e,o,s,h,c,l,a,v,y){return t.search(u,f,e,o,s,h,c,l,a,v,y).then(function(n){return r.model=new Elmah.Net.Models.LogSearchResponse(n),r}).catch(function(t){return i.add(t,null,null,"logService.search"),n.reject(t)})},c=function(u){return t.detail(u).then(function(n){var t=new Elmah.Net.Models.LogMessage(n,r.model),i=_.findIndex(r.model.messages,_.pick(t,"id"));return i!==-1?r.model.messages.splice(i,1,t):r.model.messages.push(t),r.model.message=t,r}).catch(function(t){return i.add(t,null,null,"logService.detail"),n.reject(t)})},l=function(u){return t.deleteMessage(u.id).then(function(){return u.deleted=!0,r}).catch(function(t){return i.add(t,null,null,"logService.deleteMessage"),n.reject(t)})},a=function(u){return t.update(u).then(function(n){return r.model=n,r}).catch(function(t){return i.add(t,null,null,"logService.update"),n.reject(t)})};return{model:function(){return r},filter:u,find:s,searchAndUpdate:e,detail:c,init:f,search:h,update:function(n){return a(n)},deleteByName:o,deleteMessage:l}}])}(),function(){function n(n,t,i,r,u){function f(n){n.context={};n.Create=function(){u.spin("spinner-1");r.create().then(function(t){n.context=t;u.stop("spinner-1")})};n.Check=function(){u.spin("spinner-1");r.check().then(function(t){n.context=t;u.stop("spinner-1")})};n.Check()}return{restrict:"AE",scope:{},templateUrl:"/app/log/directives/Logger.html",link:f}}angular.module("elmah.net.logger").directive("logLogger",n);n.$inject=["$window","$cookies","$timeout","SiteService","usSpinnerService"]}(),function(){function n(n,t,i,r,u,f){function e(n){n.model={types:[],sources:[],users:[],logs:[],applications:[],severities:[]};n.model.query={log:n.log,severity:n.severity,limit:n.limit,span:n.span,type:n.type,source:n.source,startMoment:moment().subtract(7,"days").startOf("day"),endMoment:moment().endOf("day")};n.filter={};n.Clear=function(){n.filter={};n.model.query={limit:100,span:1440,startMoment:moment().subtract(7,"days").startOf("day"),endMoment:moment().endOf("day")}};n.Showhide=function(n){_.forEach(n,function(n){n.visible=!n.visible})};n.SetFilter=function(t){if(n.filter=t,n.model.query=t.query,n.model.query.span==0){n.model.query.startMoment=moment(t.query.start);n.model.query.endMoment=moment(t.query.end);var i=$("#demo").data("daterangepicker");i.setStartDate(n.model.query.startMoment.format("MM/DD/YYYY"));i.setEndDate(n.model.query.endMoment.format("MM/DD/YYYY"))}n.Find(n.filter.name)};n.RefreshQuery=function(){var t=_.filter(n.model.types,{selected:!0}),i=_.filter(n.model.sources,{selected:!0}),r=_.filter(n.model.users,{selected:!0}),u=_.filter(n.model.logs,{selected:!0}),f=_.filter(n.model.applications,{selected:!0}),e=_.filter(n.model.severities,{selected:!0});n.model.query.types=_.map(t,"id");n.model.query.sources=_.map(i,"id");n.model.query.users=_.map(r,"id");n.model.query.logs=_.map(u,"id");n.model.query.applications=_.map(f,"id");n.model.query.severities=_.map(e,"name")};n.Delete=function(t){f.spin("spinner-1");n.filter={};n.RefreshQuery();u.deleteByName(t.name).then(function(t){n.model=t.model;f.stop("spinner-1");n.Refresh()})};n.Find=function(t){f.spin("spinner-1");n.RefreshQuery();u.find(t).then(function(t){n.model=t.model;f.stop("spinner-1");n.Refresh()})};n.SearchAndUpdate=function(){f.spin("spinner-1");n.RefreshQuery();var t=null,i=null;n.model.query.span===0&&n.model.query.startMoment&&n.model.query.endMoment&&(t=n.model.query.startMoment.toDate(),i=n.model.query.endMoment.toDate());u.searchAndUpdate(n.filter.name,n.filter,n.model.query.limit,n.model.query.span,n.model.query.logs,n.model.query.applications,n.model.query.severities,n.model.query.types,n.model.query.sources,n.model.query.users,t,i,n.model.query.search).then(function(t){n.model=t.model;f.stop("spinner-1");n.Refresh()})};n.Search=function(){f.spin("spinner-1");n.RefreshQuery();var t=null,i=null;n.model.query.span===0&&n.model.query.startMoment&&n.model.query.endMoment&&(t=n.model.query.startMoment.toDate(),i=n.model.query.endMoment.toDate());u.search(n.model.query.limit,n.model.query.span,n.model.query.logs,n.model.query.applications,n.model.query.severities,n.model.query.types,n.model.query.sources,n.model.query.users,t,i,n.model.query.search).then(function(t){n.model=t.model;n.model.query.span===0&&n.model.query.start&&n.model.query.end&&(n.model.query.startMoment=moment(n.model.query.start),n.model.query.endMoment=moment(n.model.query.end));f.stop("spinner-1");n.Refresh()})};n.Init=function(){f.spin("spinner-1");u.init().then(function(t){n.model=t.model;f.stop("spinner-1");n.Refresh()})};n.Refresh=function(){var t,i;n.model.query.span==0&&n.model.query.startMoment&&n.model.query.endMoment&&(t=$("#demo").data("daterangepicker"),t.setStartDate(n.model.query.startMoment.format("MM/DD/YYYY")),t.setEndDate(n.model.query.endMoment.format("MM/DD/YYYY")));n.Select(n.model.query.types,n.model.types);n.Select(n.model.query.sources,n.model.sources);n.Select(n.model.query.users,n.model.users);n.Select(n.model.query.logs,n.model.logs);n.Select(n.model.query.applications,n.model.applications);n.Select(n.model.query.severities,n.model.severities);n.model.messages.length>0&&(i=n.model.messages[0],f.spin("spinner-1"),u.detail(i.id).then(function(){f.stop("spinner-1")}))};n.Select=function(n,t){_.forEach(n,function(n){var i=_.find(t,{id:n});i&&(i.selected=!0)})};n.SelectName=function(n,t){_.forEach(n,function(n){var i=_.find(t,{name:n});i&&(i.selected=!0)})};n.Filter=function(){r.$broadcast("refreshFilter")};n.init=function(){$("#demo").daterangepicker({autoApply:!0,startDate:n.model.query.startMoment.format("MM/DD/YYYY"),endDate:n.model.query.endMoment.format("MM/DD/YYYY"),maxDate:moment().format("MM/DD/YYYY")},function(t,i){n.model.query.startMoment=moment(t).startOf("day");n.model.query.endMoment=moment(i).endOf("day");n.Search()});n.log?n.Find(n.log):n.Search()};n.init()}return{restrict:"AE",scope:{log:"@",severity:"@",limit:"@",span:"@",type:"@",source:"@"},templateUrl:"/app/log/directives/MessageFilter.html",link:e}}angular.module("elmah.net.logger").directive("logMessageFilter",n);n.$inject=["$window","$cookies","$timeout","$rootScope","LogService","usSpinnerService"]}(),function(){function n(n,t,i,r,u){function f(n){n.model={};n.messageFilter=function(n,t,i){return r.filter(n,t,i)};n.Select=function(n){u.spin("spinner-1");r.detail(n.id).then(function(){u.stop("spinner-1")})};n.Find=function(t){u.spin("spinner-1");r.find(t).then(function(t){n.model.model=t.model;u.stop("spinner-1")})};n.Delete=function(n){u.spin("spinner-1");r.deleteMessage(n).then(function(){u.stop("spinner-1")})};n.init=function(){n.log?n.Find(n.log):n.model=r.model()};n.init()}return{restrict:"AE",scope:{log:"@",severity:"@",limit:"@",span:"@"},templateUrl:"/app/log/directives/MessageList.html",link:f}}angular.module("elmah.net.logger").directive("logMessageList",n);n.$inject=["$window","$cookies","$timeout","LogService","usSpinnerService"]}(),function(){function n(n,t,i,r){function u(n){n.hasData=!1;n.model={};n.init=function(){n.model=r.model()};n.init();n.chartOptions={tooltips:{mode:"index",intersect:!0,position:"myCustomPosition",callbacks:{label:function(n,t){var i=t.datasets[n.datasetIndex],r=i.data[n.index],u;return r.y>0?(u=t.labels[n.index],i.label+": "+r.y):null}}},responsive:!0,spanGaps:!0,fullWidth:!0,maintainAspectRatio:!1,scales:{xAxes:[{type:"time",display:!0,spanGaps:!0,time:{minUnit:"day",displayFormats:{millisecond:"SSS [ms]",second:"h:mm:ss a",minute:"h:mm:ss a",hour:"MMM D, hA",day:"MMM DD",week:"MMM DD YY",month:"MMM YY",quarter:"[Q]Q - YY",year:"YYYY"}}},],yAxes:[{display:!1},]}};Chart.Tooltip.positioners.myCustomPosition=function(n,t){return{x:t.x,y:6}};n.$watch("model.model.types",function(n,t,i){i.RefreshChart()});n.$on("refreshFilter",function(){n.RefreshChart()});n.RefreshChart=function(){n.data=[];n.series=[];n.colors=[];n.hasData=!1;var t=n.model.model.types,t=_.filter(t,{selected:!0});t.length<=0&&(t=n.model.model.types);_.forEach(t,function(t){if(t.counts&&t.counts.length>0){var i="#97BBCD";i=t.color==undefined?"#97BBCD":t.color;t.color=="brown"&&(i="#800000");t.color=="orange"&&(i="#FF4500");t.color=="green"&&(i="#008000");t.color=="red"&&(i="#FF4500");t.color=="blue"&&(i="#4682B4");n.colors.push(i);n.series.push(t.name);n.data.push(t.counts);n.hasData=!0}})}}return{restrict:"AE",scope:{},templateUrl:"/app/log/directives/MessageChart.html?v=1",link:u}}angular.module("elmah.net.logger").directive("logMessageChart",n);n.$inject=["$window","$cookies","$timeout","LogService","usSpinnerService"]}(),function(){function n(n,t,i,r,u){function f(n){n.context={};n.tab="code";n.Delete=function(){u.spin("spinner-1");r.deleteMessage(n.context.model.message).then(function(){u.stop("spinner-1")})};n.init=function(){n.id?r.detail(n.id).then(function(t){n.context=t}):n.context=r.model()};n.init()}return{restrict:"AE",scope:{id:"@"},templateUrl:"/app/log/directives/MessageDetail.html",link:f}}angular.module("elmah.net.logger").directive("logMessageDetail",n);n.$inject=["$window","$cookies","$timeout","LogService","usSpinnerService"]}();